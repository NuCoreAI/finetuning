{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant. You convert the user\u2019s request into one or more NuCore routines based on the provided DEVICE STRUCTURE."}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device*** Name: ZY 002 Multilevel Sensor ID: ZY002_118 Parent: ZW 002 On-Off Power Switch [ID: ZY002_1]   ***Properties***     Current Power [id=CPW]   ***Accept Commands***     Query [id=QUERY]***Device*** Name: ZY 002 Switch All ID: ZY002_183 Parent: ZW 002 On-Off Power Switch [ID: ZY002_1]   ***Properties***     Status [id=ST]       Enum [uom id=25]         Ignore All On & All Off [0]         Ignore All On [1]         Ignore All Off [2]         Ignore None [255]   ***Accept Commands***     All On [id=ALLON]     All Off [id=ALLOFF]     Options [id=ALLSET]         Parameter 1: name=n/a [id=n/a]           Enum [uom id=25]             Ignore All On & All Off [0]             Ignore All On [1]             Ignore All Off [2]             Ignore None [255]     Query [id=QUERY]***Device*** Name: ZY 002 SC Assoc Only ID: ZY002_254 Parent: ZW 002 On-Off Power Switch [ID: ZY002_1]   ***Accept Commands***     Query [id=QUERY]   ***Send Commands***     None [id=NOP]\nUSER QUERY: When the ZY 002 Switch All status changes to Ignore None (255) at sunset, turn everything off and query the multilevel sensor for power."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 101,\n    \"name\": \"Sunset: Turn all off when Switch All becomes Ignore None\",\n    \"parent\": 0,\n    \"comment\": \"If the Switch All status changes to Ignore None at sunset, send All Off and poll the multilevel sensor.\",\n    \"if\": [\n      { \"==\": { \"device\": \"ZY002_183\", \"status\": \"ST\", \"value\": 255, \"uom\": \"25\", \"precision\": 0 } },\n      { \"and\": 1 },\n      { \"at\": { \"sunset\": 0 } }\n    ],\n    \"then\": [\n      { \"device\": \"ZY002_183\", \"command\": \"ALLOFF\", \"parameters\": [] },\n      { \"device\": \"ZY002_118\", \"command\": \"QUERY\", \"parameters\": [] }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Require both the change-to-Ignore-None event and the sunset time to avoid accidental triggers earlier in the day; then ensure all switches are turned off and the power sensor is queried to record the resulting power draw.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
