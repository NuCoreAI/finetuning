{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant. You convert the user\u2019s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\n\n## NuCore BASICS\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\nDevices are provided in a flattened format under DEVICE STRUCTURE.\nEach device begins with the label \"***Device***\" and may include:\n\n1. Properties: Real-time values such as status, temperature, brightness\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\n3. Sends Commands: Events emitted by the device\n4. Parameters: Attributes for commands \u2014 id, name, type, unit (UOM), precision, enum, or range\n\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\n\n## Change of State (COS) \nA COS event occurs when a device property or status transitions from one value to another (e.g., OFF \u0010 ON, Closed \u0010 Open, 72\u0002F \u0010 73\u0002F). It represents the moment of change, not the steady state.\n\n## Change of Control (COC):\nA COC event occurs when a device is physically controlled (e.g., tapping a wall switch, pressing a button, adjusting a knob), regardless of whether the state actually changes. It represents the act of human control, not just the resulting status.\n\n## When to Act\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\n\n(Full NuCore specification and exact token syntax expected in training data.)"}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device***\nName: Garage door to house.4 - Hear\nID: 2B 5 C0 4\nParent: Garage door to house [ID: 2B 5 C0 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n***Device***\nName: ZY 003 System Alarm\nID: ZY003_310\nParent: Frontdoor Lock [ID: ZY003_1]\n  ***Properties***\n    System Alarm [id=ALARM]\n  ***Accept Commands***\n    Query [id=QUERY]\n***Device***\nName: Jennifer Door.4 - Heartbeat\nID: 2B 2 E1 4\nParent: Door [ID: 2B 2 E1 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n\nUSER QUERY: When the garage door to house opens at sunset, check the system alarm. Also, every weekday morning between 08:00 and 09:00, if someone taps the Jennifer Door (fast on), update the garage door configuration. Finally, during the overnight window 22:00-06:00, if the garage door stops responding or Jennifer Door is fast-off, query both the garage door and the system alarm."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 101,\n    \"name\": \"Query alarm when garage opens at sunset\",\n    \"parent\": 0,\n    \"comment\": \"When garage door status becomes On at sunset, query the system alarm\",\n    \"if\": [\n      { \"at\": { \"sunset\": 0 } },\n      { \"and\": 1 },\n      { \"==\": { \"device\": \"2B 5 C0 4\", \"status\": \"ST\", \"value\": 100, \"uom\": \"51\", \"precision\": 0 } }\n    ],\n    \"then\": [\n      { \"device\": \"ZY003_310\", \"command\": \"QUERY\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Trigger a read of the system alarm whenever the garage door reports ON at sunset so the alarm state is fresh at night arrival.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 102,\n    \"name\": \"Weekday morning: on Jennifer DFON update garage WDU\",\n    \"parent\": 0,\n    \"comment\": \"When Jennifer Door receives a fast on control during weekday mornings 08:00-09:00, write changes to garage door\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"2B 2 E1 4\", \"control\": \"DFON\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"09:00\" } } } }\n    ],\n    \"then\": [\n      { \"device\": \"2B 5 C0 4\", \"command\": \"WDU\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Use the physical control (DFON) on the interior door as a cue during weekday mornings to push configuration or status writes to the garage door using its Write Changes command.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 103,\n    \"name\": \"Overnight: if garage not responding or Jennifer DFOF then query devices\",\n    \"parent\": 0,\n    \"comment\": \"If garage ERR becomes False (not responding) or Jennifer Door fast-off during 22:00-06:00, query garage and system alarm\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"2B 5 C0 4\", \"status\": \"ERR\", \"value\": 1, \"uom\": \"25\", \"precision\": 0 } },\n        { \"or\": 1 },\n        { \"==\": { \"device\": \"2B 2 E1 4\", \"control\": \"DFOF\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"from\": { \"time\": \"22:00\", \"to\": { \"time\": \"06:00\", \"day\": 1 } } }\n    ],\n    \"then\": [\n      { \"device\": \"2B 5 C0 4\", \"command\": \"QUERY\" },\n      { \"device\": \"ZY003_310\", \"command\": \"QUERY\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Overnight monitoring: if the garage stops responding or a fast-off is detected on the interior door, poll both the garage and the alarm to capture state and enable further diagnostics or alerts.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
