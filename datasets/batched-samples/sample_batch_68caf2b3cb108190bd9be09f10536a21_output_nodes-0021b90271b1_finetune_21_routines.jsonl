{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant. You convert the user\u2019s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\n\n## NuCore BASICS\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\nDevices are provided in a flattened format under DEVICE STRUCTURE.\nEach device begins with the label \"***Device***\" and may include: Properties, Accepts Commands, Sends Commands, and Parameters. NOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\n\n## Change of State (COS) and Change of Control (COC)\nCOS = a property/status transitions (moment of change). COC = a physical control action (press/tap) regardless of resulting state.\n\n## Output Format\nReturn only NuCore routine blocks between __BEGIN_NUCORE_ROUTINE__ and __END_NUCORE_ROUTINE__ as JSON objects. Provide reasoning inside each routine. If ambiguous, return a CLARIFY block.\n\nFollow the exact tokens and schedule syntaxes when building \"if\" arrays. Use device IDs and commands exactly as provided in DEVICE STRUCTURE. Do not invent IDs, parameter names, units, or values."}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device***\nName: Garage Door U-Sensor.HB\nID: 25 BF 68 4\nParent: Garage Door U-Sensor.Open [ID: 25 BF 68 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n***Device***\nName: French Door Patio Sensor.Open\nID: 25 BC 50 1\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n***Device***\nName: French Door Patio Sensor.HB\nID: 25 BC 50 4\nParent: French Door Patio Sensor.Open [ID: 25 BC 50 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n\nUSER QUERY: When the garage sensor HB opens or the French patio open is fast-turned, and it's overnight (22:00-06:00), query the garage HB; otherwise write changes to it."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 101,\n    \"name\": \"Query garage HB when opened overnight\",\n    \"parent\": 0,\n    \"comment\": \"Refresh the garage HB when opened overnight or when French patio receives a fast-on control\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"25 BF 68 4\", \"status\": \"ST\", \"value\": 100, \"uom\": \"51\", \"precision\": 0 } },\n        { \"or\": 1 },\n        { \"==\": { \"device\": \"25 BC 50 1\", \"control\": \"DFON\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"from\": { \"time\": \"22:00\", \"to\": { \"time\": \"06:00\", \"day\": 1 } } }\n    ],\n    \"then\": [\n      { \"device\": \"25 BF 68 4\", \"command\": \"QUERY\", \"parameters\": [] }\n    ],\n    \"else\": [\n      { \"device\": \"25 BF 68 4\", \"command\": \"WDU\", \"parameters\": [] }\n    ],\n    \"reasoning\": \"If the garage HB reports open (COS) or the French Patio Open emits a fast-on control (COC) during overnight hours, proactively query the garage HB to refresh state. Otherwise write changes to ensure configuration consistency.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
