{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant. You convert the user\u2019s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\n\n## NuCore BASICS\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\nDevices are provided in a flattened format under DEVICE STRUCTURE.\nEach device begins with the label \"***Device***\" and may include:\n\n1. Properties: Real-time values such as status, temperature, brightness\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\n3. Sends Commands: Events emitted by the device\n4. Parameters: Attributes for commands \u2014 id, name, type, unit (UOM), precision, enum, or range\n\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\n\n## Change of State (COS) \nA COS event occurs when a device property or status transitions from one value to another (e.g., OFF \u2192 ON, Closed \u2192 Open, 72\u00b0F \u2192 73\u00b0F). It represents the moment of change, not the steady state.\n\n## Change of Control (COC):\nA COC event occurs when a device is physically controlled (e.g., tapping a wall switch, pressing a button, adjusting a knob), regardless of whether the state actually changes. It represents the act of human control, not just the resulting status.\n\n## When to Act\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc."}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device***\nName: Front Pump (ZY023)\nID: ZY023_1\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=78]\n        Off [0]\n        On [100]\n        Unknown [101]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=78]\n            Off [0]\n            On [100]\n    Off [id=DOF]\n    Query [id=QUERY]\n    Set Configuration [id=CONFIG]\n        Parameter 1: name=Parameter Number [id=NUM]\n        Parameter 2: name=Parameter Value [id=VAL]\n          Range 0 to 255 Unit 1 Byte (Unsigned) [uom id=107]\n          Range 0 to 65535 Unit 2 Bytes (Unsigned) [uom id=108]\n          Range 0 to 4294967295 Unit 4 Bytes (Unsigned) [uom id=110]\n          Range -128 to 127 Unit 1 Byte [uom id=111]\n          Range -32768 to 32767 Unit 2 Byte [uom id=112]\n          Range -2147483648 to 214748647 Unit 4 Byte [uom id=114]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n***Device***\nName: ZY 023 Energy Meter\nID: ZY023_143\nParent: Front Pump (ZY023) [ID: ZY023_1]\n  ***Properties***\n    Total Energy [id=TPW]\n    Current Power [id=CPW]\n    Current Voltage [id=CV]\n    Current Current [id=CC]\n  ***Accept Commands***\n    Reset [id=RESET]\n    Query [id=QUERY]\n***Device***\nName: ZY 023 Power Alarm\nID: ZY023_309\nParent: Front Pump (ZY023) [ID: ZY023_1]\n  ***Properties***\n    Power Management [id=ALARM]\n  ***Accept Commands***\n    Query [id=QUERY]\n\nUSER QUERY: During weekdays (Mon-Fri) between 08:00 and 18:00, whenever I physically toggle the Front Pump (either turn it on or off), query the ZY 023 Energy Meter so I can log the energy immediately."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 101,\n    \"name\": \"Weekday manual pump control queries\",\n    \"parent\": 0,\n    \"comment\": \"When pump is manually toggled on weekdays, query the energy meter\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"ZY023_1\", \"control\": \"DON\" } },\n        { \"or\": 1 },\n        { \"==\": { \"device\": \"ZY023_1\", \"control\": \"DOF\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\n    ],\n    \"then\": [\n      { \"device\": \"ZY023_143\", \"command\": \"QUERY\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"During weekday business hours, any manual on/off (COC) of the front pump triggers an immediate query to the energy meter so operators have the latest energy data after manual interventions. The routine groups the COC checks and restricts them to mon-fri 08:00-18:00.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
