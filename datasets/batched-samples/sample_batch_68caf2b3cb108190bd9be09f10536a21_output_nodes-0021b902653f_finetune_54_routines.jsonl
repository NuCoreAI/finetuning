{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant. You convert the user\u2019s request into one or more NuCore routines based on the provided DEVICE STRUCTURE."}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device***\nName: Teds_Room_Kpd.B\nID: 4C 74 97 4\nParent: Teds_Room_Kpd.1 [ID: 4C 74 97 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 127 Unit Index [uom id=25]\n            On  0 / Off 0 [0]\n            On  1 / Off 0 [1]\n            ... (indexes continue up to 127)\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n***Device***\nName: Teds_Room_Kpd.C\nID: 4C 74 97 5\nParent: Teds_Room_Kpd.1 [ID: 4C 74 97 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 127 Unit Index [uom id=25]\n            On  0 / Off 0 [0]\n            On  1 / Off 0 [1]\n            ... (indexes continue up to 127)\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n***Device***\nName: Teds_Room_Kpd.D\nID: 4C 74 97 6\nParent: Teds_Room_Kpd.1 [ID: 4C 74 97 1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    Query [id=QUERY]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 127 Unit Index [uom id=25]\n            On  0 / Off 0 [0]\n            On  1 / Off 0 [1]\n            ... (indexes continue up to 127)\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n\nUSER QUERY: When any keypad (B, C, or D) is physically fast-on (DFON) on weekdays between 09:00 and 17:00, set that keypad's backlight to index 120 and write changes. Also, at sunset if keypad B changes state to On, set keypad B backlight to index 0 and write changes."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 101,\n    \"name\": \"Weekday Fast-On -> Backlight 120 (B,C,D)\",\n    \"parent\": 0,\n    \"comment\": \"When any keypad is physically Fast On during work hours, set its backlight high and commit.\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"4C 74 97 4\", \"control\": \"DFON\" } },\n        { \"or\": 1 },\n        { \"==\": { \"device\": \"4C 74 97 5\", \"control\": \"DFON\" } },\n        { \"or\": 1 },\n        { \"==\": { \"device\": \"4C 74 97 6\", \"control\": \"DFON\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"09:00\", \"to\": { \"time\": \"17:00\" } } } }\n    ],\n    \"then\": [\n      { \"device\": \"4C 74 97 4\", \"command\": \"BL\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 120, \"uom\": \"25\", \"precision\": 0 } ] },\n      { \"device\": \"4C 74 97 4\", \"command\": \"WDU\" },\n      { \"device\": \"4C 74 97 5\", \"command\": \"BL\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 120, \"uom\": \"25\", \"precision\": 0 } ] },\n      { \"device\": \"4C 74 97 5\", \"command\": \"WDU\" },\n      { \"device\": \"4C 74 97 6\", \"command\": \"BL\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 120, \"uom\": \"25\", \"precision\": 0 } ] },\n      { \"device\": \"4C 74 97 6\", \"command\": \"WDU\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Use a grouped COC (DFON) for each keypad ORed together and constrained to weekdays 09:00-17:00. Then set Backlight (BL) to index 120 and call WDU for each keypad so the change is committed. Separate actions for each device are used because device boundaries cannot be mixed and actions must target explicit device IDs.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 102,\n    \"name\": \"Sunset B turned On -> Backlight 0\",\n    \"parent\": 0,\n    \"comment\": \"If keypad B changes to On at sunset, turn off its backlight and commit.\",\n    \"if\": [\n      { \"at\": { \"sunset\": 0 } },\n      { \"and\": 1 },\n      { \"==\": { \"device\": \"4C 74 97 4\", \"status\": \"ST\", \"value\": 100, \"uom\": \"51\", \"precision\": 0 } }\n    ],\n    \"then\": [\n      { \"device\": \"4C 74 97 4\", \"command\": \"BL\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 0, \"uom\": \"25\", \"precision\": 0 } ] },\n      { \"device\": \"4C 74 97 4\", \"command\": \"WDU\" }\n    ],\n    \"else\": [],\n    \"reasoning\": \"A COS on keypad B to ST=On at the sunset event should immediately set its backlight index to 0 and write changes. Use the ST property with uom 51 and precision 0 since Status enumerates Off=0, On=100.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
