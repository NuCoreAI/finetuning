{"messages": [{"role": "system", "content": "You are a NuCore smart-home assistant."}, {"role": "user", "content": "DEVICE STRUCTURE:\n***Device***\nName: Hue - House 2\nID: n024_huebridge\n  ***Properties***\n    Connected [id=ST]\n      Enum [uom id=2]\n        False [0]\n        True [1]\n  ***Accept Commands***\n    Re-Discover Bulbs [id=DISCOVER]***Device***\nName: Uplight - GBT\nID: n024_88010e5f100d0b\nParent: Hue - House 2 [ID: n024_huebridge]\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n    Color Temperature [id=CLITEMP]\n      Range 2000 to 6500 Unit Kelvin [uom id=26] (step of 1 and precision of 1).\n    Transition time [id=RR]\n      Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n    X [id=GV1]\n      Range 0 to 1 Unit Raw [uom id=56]\n    Y [id=GV2]\n      Range 0 to 1 Unit Raw [uom id=56]\n    Hue [id=GV3]\n      Range 0 to 65535 Unit Raw [uom id=56] (step of 1 and precision of 1).\n    Saturation [id=GV4]\n      Range 0 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Brightness [id=GV5]\n      Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Reachable [id=GV6]\n      Enum [uom id=2]\n        False [0]\n        True [1]\n  ***Accept Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Set RGB Color [id=SET_COLOR_RGB]\n        Parameter 1: name=Red [id=R]\n          Range 0 to 255 Unit Level [uom id=100] (step of 1 and precision of 1).\n        Parameter 2: name=Green [id=G]\n          Range 0 to 255 Unit Level [uom id=100] (step of 1 and precision of 1).\n        Parameter 3: name=Blue [id=B]\n          Range 0 to 255 Unit Level [uom id=100] (step of 1 and precision of 1).\n        Parameter 4: name=Transition Time [id=D]\n          Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n        Parameter 5: name=Brightness [id=BR]\n          Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Set XY Color [id=SET_COLOR_XY]\n        Parameter 1: name=X [id=X]\n          Range 0 to 1 Unit Raw [uom id=56]\n        Parameter 2: name=Y [id=Y]\n          Range 0 to 1 Unit Raw [uom id=56]\n        Parameter 3: name=Transition Time [id=D]\n          Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n        Parameter 4: name=Brightness [id=BR]\n          Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Set Color [id=SET_COLOR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            White [24]\n    Set Hue [id=SET_HUE]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 65535 Unit Raw [uom id=56] (step of 1 and precision of 1).\n    Set Saturation [id=SET_SAT]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Set Brightness [id=SET_BRI]\n        Parameter 1: name=n/a [id=n/a]\n          Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Set Color Temperature [id=CLITEMP]\n        Parameter 1: name=n/a [id=n/a]\n          Range 2000 to 6500 Unit Kelvin [uom id=26] (step of 1 and precision of 1).\n    Set Temp and Brightness [id=SET_CTBR]\n        Parameter 1: name=Color Temperature [id=K]\n          Range 2000 to 6500 Unit Kelvin [uom id=26] (step of 1 and precision of 1).\n        Parameter 2: name=Transition Time [id=D]\n          Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n        Parameter 3: name=Brightness [id=BR]\n          Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n    Set Transition Time [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n    Set HSB Color [id=SET_HSB]\n        Parameter 1: name=Hue [id=H]\n          Range 0 to 65535 Unit Raw [uom id=56] (step of 1 and precision of 1).\n        Parameter 2: name=Saturation [id=S]\n          Range 0 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n        Parameter 3: name=Brightness [id=BR]\n          Range 1 to 254 Unit Level [uom id=100] (step of 1 and precision of 1).\n        Parameter 4: name=Transition Time [id=D]\n          Range 0 to 540000 Unit millisecond [uom id=42] (step of 100 and precision of 1).\n    Set Alert [id=SET_ALERT]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            None [1]\n            Breathe [2]\n            Long Breathe [3]\n    Set Effect [id=SET_EFFECT]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            None [1]\n            Colorloop [2]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n***Device***\nName: Uplights\nID: n024_huegrp81\nParent: Hue - House 2 [ID: n024_huebridge]\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n    Number of Lights [id=GV6]\n      Range 0 to 50 Unit Raw [uom id=56]\n  ***Accept Commands***\n    Set Temp and Brightness [id=SET_CTBR]\n    Set Color [id=SET_COLOR]\n    Set RGB Color [id=SET_COLOR_RGB]\n    On [id=DON]\n    Off [id=DOF]\n\nUSER QUERY: When it's sunset and the Hue bridge is connected, set the Uplights group to 2700K at about 80% brightness. Also, if someone fast-on (DFON) the single Uplight - GBT between 22:00 and 06:00, set that bulb to blue (RGB 0,0,255) at brightness 180 with a 2000ms transition; if they fast-off (DFOF) turn the same bulb off. Finally, if the single Uplight's Status drops below 20% while the Uplights group has at least one light, raise the single Uplight to brightness 150 over 2000ms. Also on 2025/09/03 at 08:30 set the Uplights group to White."}, {"role": "assistant", "content": "__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 1,\n    \"name\": \"Sunset warm uplights if bridge connected\",\n    \"parent\": 0,\n    \"comment\": \"Set group warm white at sunset only if bridge connected\",\n    \"if\": [\n      { \"at\": { \"sunset\": 0 } },\n      { \"and\": 1 },\n      { \"==\": { \"device\": \"n024_huebridge\", \"status\": \"ST\", \"value\": 1, \"uom\": \"2\", \"precision\": 0 } }\n    ],\n    \"then\": [\n      {\n        \"device\": \"n024_huegrp81\",\n        \"command\": \"SET_CTBR\",\n        \"parameters\": [\n          { \"name\": \"K\", \"value\": 2700, \"uom\": \"26\", \"precision\": 1 },\n          { \"name\": \"D\", \"value\": 5000, \"uom\": \"42\", \"precision\": 1 },\n          { \"name\": \"BR\", \"value\": 200, \"uom\": \"100\", \"precision\": 1 }\n        ]\n      }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Apply warm color temperature and reduced brightness at sunset only when the Hue bridge reports connected to avoid sending commands to an offline bridge. Use SET_CTBR on the group to set both color temperature and brightness in one command.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 2,\n    \"name\": \"Overnight DFON -> set GBT blue\",\n    \"parent\": 0,\n    \"comment\": \"When Fast On is used on the single uplight overnight, set it to blue\",\n    \"if\": [\n      { \"(\": 1 },\n        { \"==\": { \"device\": \"n024_88010e5f100d0b\", \"control\": \"DFON\" } },\n      { \")\": 1 },\n      { \"and\": 1 },\n      { \"from\": { \"time\": \"22:00\", \"to\": { \"time\": \"06:00\", \"day\": 1 } } }\n    ],\n    \"then\": [\n      {\n        \"device\": \"n024_88010e5f100d0b\",\n        \"command\": \"SET_COLOR_RGB\",\n        \"parameters\": [\n          { \"name\": \"R\", \"value\": 0, \"uom\": \"100\", \"precision\": 1 },\n          { \"name\": \"G\", \"value\": 0, \"uom\": \"100\", \"precision\": 1 },\n          { \"name\": \"B\", \"value\": 255, \"uom\": \"100\", \"precision\": 1 },\n          { \"name\": \"D\", \"value\": 2000, \"uom\": \"42\", \"precision\": 1 },\n          { \"name\": \"BR\", \"value\": 180, \"uom\": \"100\", \"precision\": 1 }\n        ]\n      }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Detect physical Fast On (COC) on the single uplight during night hours and set a blue color with a smooth 2s transition at desired brightness. Using a dedicated routine keeps DFON behavior separate from other controls.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 3,\n    \"name\": \"DFOF -> turn off GBT\",\n    \"parent\": 0,\n    \"comment\": \"Turn off the single uplight when Fast Off is used\",\n    \"if\": [\n      { \"==\": { \"device\": \"n024_88010e5f100d0b\", \"control\": \"DFOF\" } }\n    ],\n    \"then\": [\n      { \"device\": \"n024_88010e5f100d0b\", \"command\": \"DOF\", \"parameters\": [] }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Direct mapping: when the user physically uses Fast Off on the uplight, turn that device off. This routine runs independently of time window.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 4,\n    \"name\": \"Low brightness COS -> raise GBT\",\n    \"parent\": 0,\n    \"comment\": \"When single uplight brightness falls below 20% and group has at least one light, raise brightness over 2s\",\n    \"if\": [\n      { \"<\": { \"device\": \"n024_88010e5f100d0b\", \"status\": \"ST\", \"value\": 20, \"uom\": \"51\", \"precision\": 0 } },\n      { \"and\": 1 },\n      { \">=\": { \"device\": \"n024_huegrp81\", \"status\": \"GV6\", \"value\": 1, \"uom\": \"56\", \"precision\": 1 } }\n    ],\n    \"then\": [\n      { \"device\": \"n024_88010e5f100d0b\", \"command\": \"RR\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 2000, \"uom\": \"42\", \"precision\": 1 } ] },\n      { \"device\": \"n024_88010e5f100d0b\", \"command\": \"SET_BRI\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 150, \"uom\": \"100\", \"precision\": 1 } ] }\n    ],\n    \"else\": [],\n    \"reasoning\": \"Respond to a COS of the single uplight's Status dropping below 20% only when the group has at least one light; first set a 2s transition time then set brightness to 150 to avoid abrupt jumps.\"\n  }\n}\n__END_NUCORE_ROUTINE__\n\n__BEGIN_NUCORE_ROUTINE__\n{\n  \"routine\": {\n    \"id\": 5,\n    \"name\": \"Morning 2025-09-03 set Uplights White\",\n    \"parent\": 0,\n    \"comment\": \"Set group to White at a specific date/time\",\n    \"if\": [\n      { \"at\": { \"time\": \"08:30\", \"date\": \"2025/09/03\" } }\n    ],\n    \"then\": [\n      { \"device\": \"n024_huegrp81\", \"command\": \"SET_COLOR\", \"parameters\": [ { \"name\": \"n/a\", \"value\": 24, \"uom\": \"25\", \"precision\": 0 } ] }\n    ],\n    \"else\": [],\n    \"reasoning\": \"A scheduled one-off action to set the group to the built-in White enum on the requested date/time.\"\n  }\n}\n__END_NUCORE_ROUTINE__"}]}
