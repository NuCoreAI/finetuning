{"custom_id": "nodes-0021b9025fa1_finetune_1_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Couch Right\nID: 35 1E 43 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Santa and Tree\nID: 35 2C 8 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Bookcase\nID: 35 30 C9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_2_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Great Room Night Light\nID: 35 32 19 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Den Night Light\nID: 3E 76 E3 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Den Porch\nID: 4C 41 F9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_3_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Workbench\nID: 35 4D 54 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Fan\nID: ZY002_1\n  ***Properties***\n    Status [id=ST]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            Previous Value [1]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast On [id=DFON]\n    Fast Off [id=DFOF]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n        Parameter 1: name=Start Level [id=STARTLEVEL]\n          Enum [uom id=25]\n            Previous Value [1]\n          Range 0 to 100 Unit % [uom id=51]\n    Fade Down [id=FDDOWN]\n        Parameter 1: name=Start Level [id=STARTLEVEL]\n          Enum [uom id=25]\n            Previous Value [1]\n          Range 0 to 100 Unit % [uom id=51]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Set Configuration [id=CONFIG]\n        Parameter 1: name=Parameter Number [id=NUM]\n        Parameter 2: name=Parameter Value [id=VAL]\n          Range 0 to 255 Unit 1 Byte (Unsigned) [uom id=107]\n          Range 0 to 65535 Unit 2 Bytes (Unsigned) [uom id=108]\n          Range 0 to 4294967295 Unit 4 Bytes (Unsigned) [uom id=110]\n          Range -128 to 127 Unit 1 Byte [uom id=111]\n          Range -32768 to 32767 Unit 2 Byte [uom id=112]\n          Range -2147483648 to 214748647 Unit 4 Byte [uom id=114]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]***Device***\nName: Back Porch Inside\nID: 3B B0 90 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_4_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Great Room ceiling\nID: 3B CB 21 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Kitchen Bar\nID: 3B AB 5C 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Dinner Table\nID: 3B BC D 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_5_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Front Porch\nID: 4C 4D 91 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Laundry Room ceiling\nID: 3B B5 21 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Master Bath sink\nID: 3B AC 34 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_6_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Spare Bedroom ceiling\nID: 38 1A E9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Pool Shed Ceiling\nID: 3B CF A7 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Den\nID: 43 3C 5A 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_7_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Couch Left\nID: 35 31 9A 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Kitchen Cabinet\nID: 35 2C 29 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Kitchen Sink\nID: 3B BB 56 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_8_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Christmas Tree Kitchen\nID: 37 63 46 1\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]***Device***\nName: Garage Three\nID: 4C 4E A5 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Garage Two\nID: 4C 47 27 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_9_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Garage One\nID: 4C 28 3F 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Garage Pool\nID: 4C 48 F2 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Notification Controller\nID: n003_controller\n  ***Properties***\n    NodeServer Online [id=ST]\n      Enum [uom id=25]\n        Disconnected [0]\n        Connected [1]\n        Failed [2]\n    REST Status [id=GV1]\n      Enum [uom id=25]\n        Not Running [0]\n        Running [1]\n        Failed [2]\n        Receive Error [3]\n    Message [id=GV2]\n      Enum [uom id=25]\n  ***Accept Commands***\n    Message [id=SET_MESSAGE]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n    System Custom Content [id=SET_SYS_CUSTOM]\n        Parameter 1: name=n/a [id=n/a]\n    Query [id=QUERY]\n    Build Profile [id=BUILD_PROFILE]\n    Install Profile [id=INSTALL_PROFILE]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_10_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Great Room Cans\nID: 4C 2F 67 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Great Room Cans Three\nID: 49 A2 C7 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Great Room Cans Two\nID: 49 BC 57 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_11_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Steps\nID: 4C 4B C2 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Fireplace Windows\nID: 49 A0 A7 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: ZY 002 Scene Responder\nID: ZY002_259\nParent: Fan [ID: ZY002_1]\n  ***Accept Commands***\n    Query [id=QUERY]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_12_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: ZY 002 Switch All\nID: ZY002_183\nParent: Fan [ID: ZY002_1]\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=25]\n        Ignore All On & All Off [0]\n        Ignore All On [1]\n        Ignore All Off [2]\n        Ignore None [255]\n  ***Accept Commands***\n    All On [id=ALLON]\n    All Off [id=ALLOFF]\n    Options [id=ALLSET]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            Ignore All On & All Off [0]\n            Ignore All On [1]\n            Ignore All Off [2]\n            Ignore None [255]\n    Query [id=QUERY]***Device***\nName: UD Mobile\nID: n003_udmobile\nParent: Notification Controller [ID: n003_controller]\n  ***Properties***\n    Last Status [id=ST]\n      Enum [uom id=2]\n        False [0]\n        True [1]\n    Error [id=ERR]\n      Enum [uom id=25]\n        None [0]\n        Illegal Value [1]\n        App Auth [2]\n        User Auth [3]\n        Create Message [4]\n        Send Message [5]\n        Bad Parameter [6]\n  ***Accept Commands***\n    Send Message [id=GV10]\n        Parameter 1: name=Group [id=Group]\n          Enum [uom id=25]\n            default [0]\n            1\n            2\n            3\n            4\n            6\n        Parameter 2: name=Sound [id=Sound]\n          Enum [uom id=25]\n            default [0]\n            Clock Radio Alarm [1]\n            SMS Notification [2]\n            Dog Bark [3]\n            Small Resonant Alarm [4]\n            Software Start Positive [5]\n            UI Notification [6]\n            Alarm Burglar [7]\n            Rooster Crowing [8]\n            Hawk [9]\n        Parameter 3: name=Content [id=Content]***Device***\nName: Entry Outside\nID: 4E CE EC 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_13_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Entry Cans\nID: 4E CA C6 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Pictures\nID: 4E D5 21 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Bistro\nID: 4E D8 5C 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_14_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Back Porch Outside\nID: 4E CC 4D 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Coat Closet\nID: 4E CD 3A 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Sconces\nID: 4E D7 7F 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_15_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Office Pole Lamp\nID: 32 C9 1B 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Master Fan Light\nID: 4B EF A9 1\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]***Device***\nName: ZY 002 SC Dimmer Assoc 2\nID: ZY002_258N002\nParent: Fan [ID: ZY002_1]\n  ***Accept Commands***\n    Query [id=QUERY]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_16_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Fence\nID: 3A 2E 37 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Window Two\nID: 3E 80 D7 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Window Three\nID: 3E 77 E7 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_17_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Christmas Window Four\nID: 35 40 22 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Office Christmas Tree\nID: 4E 5C 29 1\n  ***Properties***\n    Status [id=ST]\n      Enum [uom id=51]\n        Off [0]\n        On [100]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]***Device***\nName: ZY 002 SC Dimmer Assoc 3\nID: ZY002_258N003\nParent: Fan [ID: ZY002_1]\n  ***Accept Commands***\n    Query [id=QUERY]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_18_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Christmas Window Five\nID: 3A 1B 86 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Window Six\nID: 3A 59 F8 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Window Seven\nID: 3A 7B CF 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_19_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Christmas Window Eight\nID: 3A 11 A9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Dining\nID: 35 DE BF 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Step Night Light\nID: 2E C9 6F 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_20_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Christmas TV 11\nID: 3A D B 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Couch 13\nID: 35 B4 27 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Gazebo One\nID: 51 C8 FF 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_21_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Hallway\nID: 4E CB F9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Front Bath Sink\nID: 4E D6 59 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Dining 2\nID: 3B AC FF 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_22_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Master bath fan light\nID: 51 A1 1F 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Master bath fan\nID: 51 A2 BE 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Front Bath Sconces\nID: 51 A1 B8 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_23_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Laundry Dryer\nID: 51 A2 A5 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Gazebo Two\nID: 51 C5 C3 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Christmas Window One\nID: 3A 17 52 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_24_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Office Topiary One\nID: 51 C8 E9 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Office Topiary Two\nID: 51 C8 83 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Office Table\nID: 35 1F 2 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
{"custom_id": "nodes-0021b9025fa1_finetune_25_routines", "method": "POST", "url": "/v1/chat/completions", "body": {"model": "gpt-4.1-mini", "temperature": 0.0, "messages": [{"role": "system", "content": "You are a samples generator that generates training samples for NuCore SmartHome Technology in OpenAI chat fine-tuning JSONL (one line per sample).\n\nThe output format for each sample must strictly adhere to ChatML format for training:\n\n{\"messages\":[\n  {\"role\":\"system\",\"content\":\"You are a NuCore smart-home assistant. You convert the user’s request into one or more NuCore routines based on the provided DEVICE STRUCTURE.\\n\\n## NuCore BASICS\\nNuCore is a platform for managing and automating smart devices through structured commands and logic.\\nDevices are provided in a flattened format under DEVICE STRUCTURE.\\nEach device begins with the label \"***Device***\" and may include:\\n\\n1. Properties: Real-time values such as status, temperature, brightness\\n2. Accepts Commands: Actions that can be sent to the device (e.g., DON, DOF)\\n3. Sends Commands: Events emitted by the device\\n4. Parameters: Attributes for commands — id, name, type, unit (UOM), precision, enum, or range\\n\\nNOTE: Device boundaries are defined by the \"***Device***\" labels. Never mix properties or commands across devices.\\n\\n## When to Act\\nWhen the user asks for automated and optimized behavior. Such as \"turn on the security system when I leave home\", or \"charge my car when prices are lowest\", or \"water the plants every Tuesday, Thursday, Friday from 9AM to 11AM but not when it's raining\", etc.\\n\\n\\n## Output Format (strict)\\n\\nReturn only:\\nOne or more fenced NuCore routine blocks (no prose between blocks). Each block is embedded between __BEGIN_NUCORE_ROUTINE__\\nand __END_NUCORE_ROUTINE__ as follows:\\n\\n__BEGIN_NUCORE_ROUTINE__\\n{\\n  \"routine\": {\\n    \"id\": <int>,\\n    \"name\": \"<descriptive name>\",\\n    \"parent\": 0,\\n    \"comment\": \"<optional>\",\\n    \"if\": [ /* ordered flat Condition Tokens */ ],\\n    \"then\": [ /* actions */ ],\\n    \"else\": [ /* actions */ ],\\n    \"reasoning\": \"<assistant's reasoning for the structure and semantics of this routine>\" \\n  }\\n}\\n__END_NUCORE_ROUTINE__\\n\\n\\n- \"parent\" required (`0` = root)\\n- \"if\" = flat ordered array of tokens (no nesting)\\n- \"then\"/\"else\" = arrays of actions\\n- \"value\" integer only; decimals via \"precision\"\\n- \"reasoning\" is optional and must be IGNORED if requested \\n- If the request is ambiguous, follow up with a CLARIFY stucture as defined below\\n__BEGIN_NUCORE_ROUTINE_CLARIFY__\\n{\\n  \"clarify\": \"The requested clarification content and question\",\\n  \"reasoning\": \"optional clear, concise, and contextal reasoning generated by the assistant.\" \\n}\\n__END_NUCORE_ROUTINE_CLARIFY__\\n\\n---\\n\\n**Condition Tokens**\\n\\n- COS (Change of State):\\n  { \">=\": { \"device\":\"13 18 26_1\",\"status\":\"ST\",\"value\":7500,\"uom\":\"17\",\"precision\":2 } }\\n- COC (Change of Control):\\n  { \"==\": { \"device\":\"18 18 18\",\"control\":\"DFON\",\"parameters\":[{ \"name\":\"tapCount\",\"value\":2,\"uom\":\"108\",\"precision\":0 }] } }\\n- Schedules (13 forms, **exact syntax**):\\n  1. `{ \"at\": { \"time\": \"13:00\" } }`\\n  2. `{ \"at\": { \"sunrise\": -900 } }`\\n  3. `{ \"at\": { \"sunset\": 600 } }`\\n  4. `{ \"from\": { \"sunrise\": 0, \"for\": { \"hours\":1,\"minutes\":30,\"seconds\":0 } } }`\\n  5. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0 } } }`\\n  6. `{ \"from\": { \"sunrise\": 0, \"to\": { \"sunset\": 0, \"day\":1 } } }`\\n  7. `{ \"from\": { \"time\":\"13:00\",\"to\":{ \"sunset\":0,\"day\":1 } } }`\\n  8. `{ \"from\": { \"time\":\"09:00\",\"to\":{ \"time\":\"18:00\",\"day\":0 } } }`\\n  9. `{ \"at\": { \"time\":\"08:30\",\"date\":\"2025/09/03\" } }`\\n  10. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"for\":{ \"hours\":2,\"minutes\":0,\"seconds\":0 } } }`\\n  11. `{ \"from\": { \"time\":\"08:30\",\"date\":\"2025/09/03\",\"to\":{ \"time\":\"17:00\",\"date\":\"2025/09/04\" } } }`\\n  12. `{ \"from\": { \"time\":\"22:00\",\"to\":{ \"time\":\"06:00\",\"day\":1 } } }`\\n  13. `{ \"weekly\": { \"days\":\"sun,mon,tue,wed,thu,fri,sat\",\"from\":{ \"time\":\"09:00\",\"to\":{ \"time\":\"17:00\" } } } }`\\n    - Alt weekly: use `\"for\": { \"hours\":2,\"minutes\":0,\"seconds\":0 }`\\n    - Days string lowercase, canonical, no spaces\\n  NOTE: The sunrise and sunset values are integer offsets in seconds from the event: negative = before, positive = after, 0 = exactly at the event.\\n\\n- Logical operators\\n{ \"and\": 1 }\\n{ \"or\": 1 }\\n{ \"(\": 1 }\\n{ \")\": 1 }\\nLogical operators mimic natural language flows and do not contain objects.\\nWrite logical operators exactly as:\\n{ \"(\": 1 } and { \")\": 1 }\\nDo not escape parentheses. Only escape double quotes where JSON requires it.\\n\\n- Mathematical operators\\nUse their natural language form: >, >=, <, <=, == (is or equals to), =! (is not)\\n\\nExamples:\\n\\n-- COS + Schedule + Price\\n\"if\": [\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"and\": 1 },\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n\"if\": [\\n  { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 350, \"uom\": \"33\", \"precision\": 2 } },\\n  { \"and\": 1 },\\n  { \"at\": { \"sunset\": 0 } },\\n  { \"or\": 1 },\\n  { \">=\": { \"device\": \"id_for_hvac\", \"status\": \"ST\", \"value\": 7000, \"uom\": \"17\", \"precision\": 2 } }\\n]\\n\\n-- Grouped COS + COC + Weekly\\n\"if\": [\\n  { \"(\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_1\", \"control\": \"DFON\" } },\\n    { \"or\": 1 },\\n    { \"==\": { \"device\": \"id_for_device_2\", \"control\": \"DON\" } },\\n  { \")\": 1 },\\n  { \"and\": 1 },\\n  { \"weekly\": { \"days\": \"mon,tue,wed,thu,fri\", \"from\": { \"time\": \"08:00\", \"to\": { \"time\": \"18:00\" } } } }\\n]\\n\\n-- Multiple Groups, Mixed Triggers\\n\"if\": [\\n  { \"(\": 1 },\\n    { \">\": { \"device\": \"id_for_thermostat_1\", \"status\": \"ST\", \"value\": 7500, \"uom\": \"17\", \"precision\": 2 } },\\n    { \"and\": 1 },\\n    { \"<\": { \"device\": \"id_for_price_sensor\", \"status\": \"ST\", \"value\": 250, \"uom\": \"33\", \"precision\": 2 } },\\n  { \")\": 1 },\\n  { \"or\": 1 },\\n  { \"at\": { \"sunrise\": 600 } },\\n  { \"or\": 1 },\\n  { \"IS\": { \"device\": \"fan\", \"control\": \"DFON\" } }\\n]\\n\\n---\\n\\n**Actions**\\n{\\n  \"device\":\"<device id>\",\\n  \"command\":\"<command name>\",\\n  \"parameters\":[\\n    { \"name\":\"<parameter name>\",\"value\":<a number>,\"uom\":\"<uom id>\",\"precision\":2 }\\n  ]\\n}\\n\\n\\n- Use device ID for device\\n- Use correct UOM ID for uom\\n- Commands must exist in device’s `accepts` list\\n- Use accurate ids, names, and precisions from DEVICE STRUCTURE\\n\\n---\\n\\n## CRITICAL RULES\\n\\n- Do provide reasoning, thinking, or any explanations **unless** otherwise requested\\n- Put reasoning inside the routine schema \\n- Do **not** guess, invent, or hallucinate IDs, parameters, units, or values.\\n- Only use what is explicitly defined in the DEVICE STRUCTURE.\\n- Remain minimal, structured, and consistent.\\n- All other answers must be short, factual, and grounded.\\n\\n---\"},\n  {\"role\":\"user\",\"content\":\"DEVICE STRUCTURE:\\n***Device***\nName: Great Room Christmas Tree\nID: 51 C8 4 1\n  ***Properties***\n    Status [id=ST]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    On Level [id=OL]\n      Range 0 to 100 Unit % [uom id=51]\n        Off [0]\n    Ramp Rate [id=RR]\n      Enum [uom id=25]\n        9.0 minutes [0]\n        8.0 minutes [1]\n        7.0 minutes [2]\n        6.0 minutes [3]\n        5.0 minutes [4]\n        4.5 minutes [5]\n        4.0 minutes [6]\n        3.5 minutes [7]\n        3.0 minutes [8]\n        2.5 minutes [9]\n        2.0 minutes [10]\n        1.5 minutes [11]\n        1.0 minute [12]\n        47.0 seconds [13]\n        43.0 seconds [14]\n        38.5 seconds [15]\n        34.0 seconds [16]\n        32.0 seconds [17]\n        30.0 seconds [18]\n        28.0 seconds [19]\n        26.0 seconds [20]\n        23.5 seconds [21]\n        21.5 seconds [22]\n        19.0 seconds [23]\n        8.5 seconds [24]\n        6.5 seconds [25]\n        4.5 seconds [26]\n        2.0 seconds [27]\n        0.5 seconds [28]\n        0.3 seconds [29]\n        0.2 seconds [30]\n        0.1 seconds [31]\n    Responding [id=ERR]\n      Enum [uom id=25]\n        True [0]\n        False [1]\n  ***Accept Commands***\n    On [id=DON]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Brighten [id=BRT]\n    Dim [id=DIM]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Query [id=QUERY]\n    Beep [id=BEEP]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=100]\n    On Level [id=OL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n            Off [0]\n    Ramp Rate [id=RR]\n        Parameter 1: name=n/a [id=n/a]\n          Enum [uom id=25]\n            9.0 minutes [0]\n            8.0 minutes [1]\n            7.0 minutes [2]\n            6.0 minutes [3]\n            5.0 minutes [4]\n            4.5 minutes [5]\n            4.0 minutes [6]\n            3.5 minutes [7]\n            3.0 minutes [8]\n            2.5 minutes [9]\n            2.0 minutes [10]\n            1.5 minutes [11]\n            1.0 minute [12]\n            47.0 seconds [13]\n            43.0 seconds [14]\n            38.5 seconds [15]\n            34.0 seconds [16]\n            32.0 seconds [17]\n            30.0 seconds [18]\n            28.0 seconds [19]\n            26.0 seconds [20]\n            23.5 seconds [21]\n            21.5 seconds [22]\n            19.0 seconds [23]\n            8.5 seconds [24]\n            6.5 seconds [25]\n            4.5 seconds [26]\n            2.0 seconds [27]\n            0.5 seconds [28]\n            0.3 seconds [29]\n            0.2 seconds [30]\n            0.1 seconds [31]\n    Backlight [id=BL]\n        Parameter 1: name=n/a [id=n/a]\n          Range 0 to 100 Unit % [uom id=51]\n    Write Changes [id=WDU]\n  ***Send Commands***\n    On [id=DON]\n    Off [id=DOF]\n    Fast Off [id=DFOF]\n    Fast On [id=DFON]\n    Fade Up [id=FDUP]\n    Fade Down [id=FDDOWN]\n    Fade Stop [id=FDSTOP]\n    Brighten [id=BRT]\n    Dim [id=DIM]***Device***\nName: Nest Controller\nID: n002_nestctrl\n  ***Properties***\n    NodeServer Online [id=ST]\n      Enum [uom id=2]\n        False [0]\n        True [1]\n  ***Accept Commands***\n    Re-Discover [id=DISCOVER]\\n\\nUSER QUERY: <natural language request for automation and optimization>\"},\n  {\"role\":\"assistant\",\"content\":\"<ASSISTANT RESPONSE>\"}\n]}\n\nNow, analyze the content in system role above and DEVICE STRUCTURE in the user role above and generate a minimum of 3 samples: \nFor each sample:\n1. Generate a realistic natural language use case for automation and optimization that covers combinations of COS, COC, and Schedule\n2. Embed the use case in USER QUERY\n3. For the use case in the USER QUERY, create a routine that implements the use case with maximum accuracy \n4. Balance across multiple devices \n\n\n"}]}}
